<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Chapter 7: Data Visualisation with R</title>

<script src="chapter7_files/header-attrs-2.11/header-attrs.js"></script>
<script src="chapter7_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="chapter7_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="chapter7_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="chapter7_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="chapter7_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="chapter7_files/navigation-1.1/tabsets.js"></script>
<link href="chapter7_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="chapter7_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "î‰™";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "î‰™";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Chapter 7: Data Visualisation with R</h1>

</div>


<style>
.target {
  border: 3px solid black;
  padding: 10px;
  padding-top: 35px;
  margin-bottom: 10px;
}
.target:before {
  position: absolute;
  content: "ðŸŽ¯ your target plot";
  padding: 5px;
  margin-left: -13px;
  margin-top: -38px;
  background-color: #003366;
  font-size: 12pt;
  border: 3px solid black;
  color: white;
}
</style>
<p><exercise id="1" title="R Graphics" type="slides"></p>
<iframe src="../slides/chapter7_01_rgraphics.html" width="800" height="500">
</iframe>
<p></exercise></p>
<p><exercise id="2" title="Test your knowledge of R Graphics"></p>
<p>Which of the following is a contributed R package?</p>
<div>
<p><input type="radio"> ggplot2 | <span style="color:red">CORRECT</span>
Thatâ€™s correct! ggplot2 was developed by Hadley Wickham as part of his
PhD.</p>
<p><input type="radio"> grid | No, this is a core package so itâ€™s
already installed.</p>
<p><input type="radio"> graphics | No, this a core package and loads
automatically when you launch R.</p>
<p><input type="radio"> grDevices | No, this a core package and loads
automatically when you launch R.</p>
</div>
<p>Which R package actually renders the graphics in R?</p>
<div>
<p><input type="radio"> ggplot2 | No, thatâ€™s incorrect.</p>
<p><input type="radio"> grid | No, thatâ€™s incorrect.</p>
<p><input type="radio"> graphics | No, thatâ€™s incorrect.</p>
<p><input type="radio"> grDevices | <span
style="color:red">CORRECT</span> Yes, thatâ€™s right!</p>
</div>
<p>Remember that there are two primary graphic models in R: the base and
grid graphics. Which one is <code>ggplot2</code> using?</p>
<div>
<p><input type="radio"> base | No, thatâ€™s incorrect.</p>
<p><input type="radio"> grid | <span style="color:red">CORRECT</span>
Yes thatâ€™s right! Well done!</p>
</div>
<p></exercise></p>
<p><exercise id="3" title="Getting started with `ggplot2`" type="slides"></p>
<iframe src="../slides/chapter7_02_ggplot2intro.html" width="800" height="500">
</iframe>
<p></exercise></p>
<p><exercise id="4" title="Make basic plots with `ggplot2`"></p>
<p>For the following questions we are going to use
<code>BudgetFood</code> data from the <code>Ecdat</code> package which
contains the budget share of food for Spanish households. You can load
the dataset and see the structure of the data below.</p>
<pre class="r"><code>library(Ecdat)
str(BudgetFood)</code></pre>
<pre><code>## &#39;data.frame&#39;:    23972 obs. of  6 variables:
##  $ wfood : num  0.468 0.313 0.376 0.44 0.404 ...
##  $ totexp: num  1290941 1277978 845852 527698 1103220 ...
##  $ age   : num  43 40 28 60 37 35 40 68 43 51 ...
##  $ size  : num  5 3 3 1 5 4 4 2 9 7 ...
##  $ town  : num  2 2 2 2 2 2 2 2 2 2 ...
##  $ sex   : Factor w/ 2 levels &quot;man&quot;,&quot;woman&quot;: 1 1 1 2 1 1 1 2 1 1 ...</code></pre>
<p>The meaning of the variables are described below:</p>
<ul>
<li><code>wfood</code>: percentage of total expenditure which the
household has spent on food</li>
<li><code>totexp</code>: total expenditure of the household</li>
<li><code>age</code>: age of reference person in the household</li>
<li><code>size</code>: size of the household</li>
<li><code>town</code>: size of the town where the household is placed
categorized into 5 groups: 1 for small towns, 5 for big ones</li>
<li><code>sex</code>: sex of reference person (man,woman)</li>
</ul>
<p>Try to recreate the scatter plot below. Is there anything that
unusual that you notice about the plot?</p>
<div class="target">
<img src="ch7/plot4A-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04A"></p>
<p></codeblock></p>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____,  </code>
<code>                      y = _____)) + </code>
<code>   geom______() </code>
</pre>
<details open>
<summary>
Hint
</summary>
The scatter plots are created using <code>geom_point</code>.
</details>
<div class="target">
<img src="ch7/plot4B-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04B"></p>
<p></codeblock></p>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____,  </code>
<code>                      y = _____)) + </code>
<code>   geom______() </code>
</pre>
<details open>
<summary>
Hint
</summary>
The hex plots are created using <code>geom_hex</code>.
</details>
<div class="target">
<img src="ch7/plot4C-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04C"></p>
<p></codeblock></p>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____,  </code>
<code>                      y = _____)) + </code>
<code>   geom______() </code>
</pre>
<details open>
<summary>
Hint
</summary>
This is a hint.
</details>
<div class="target">
<img src="ch7/plot4D-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04D"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____,  </code>
<code>                      y = _____)) + </code>
<code>   geom______() </code>
</pre>
<details open>
<summary>
Hint
</summary>
This is a hint.
</details>
<div class="target">
<img src="ch7/plot4E-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04E"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____)) + </code>
<code>   geom______(binwidth = 0.001) </code>
</pre>
<details open>
<summary>
Hint
</summary>
This is a hint.
</details>
<div class="target">
<img src="ch7/plot4F-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_04F"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____)) + </code>
<code>   geom______() </code>
</pre>
<details open>
<summary>
Hint
</summary>
This is a hint.
</details>
<p></exercise></p>
<p><exercise id="5" title="Multiple layers in `ggplot2`">
<iframe src='../slides/chapter7_03_ggplot2layers.html' width='800' height='500'></iframe>
</exercise></p>
<p><exercise id="6" title="Practice creating multiple layers"></p>
<p>We are again going to use the <code>BudgetFood</code> data from the
<code>Ecdat</code> package to make the plots.</p>
<p>Try to recreate the scatter plot below. Is there anything that
unusual that you notice about the plot?</p>
<div class="target">
<img src="ch7/plot6A-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_06A"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____)) + </code>
<code>   geom______(aes(y = stat(density))) + </code>
<code>   geom______(color = "red") </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot6B-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_06B"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____, </code>
<code>                      y = _____)) + </code>
<code>   geom______(_____) + </code>
<code>   geom______(_____ = 0.1)  </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot6C-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_06C"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____, </code>
<code>                      y = _____)) + </code>
<code>   geom______() + </code>
<code>   geom______(color = "red", </code>
<code>                   method = loess, </code>
<code>                   formula = y ~ x) </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot6D-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_06D"></p>
</codeblock>
<pre class="r">
<code> library(ggplot2) </code>
<code> library(Ecdat) </code>
<code> ggplot(data = _____,  </code>
<code>        mapping = aes(x = _____)) + </code>
<code>   geom______() + </code>
<code>   geom______(aes(label = _____), </code>
<code>                  vjust = -0.3, </code>
<code>                  stat = _____) </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot6E-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_06E"></p>
</codeblock>
<pre class="r">
<code> library(tidyverse) </code>
<code> library(Ecdat) </code>
<code> dat <- BudgetFood %>%  </code>
<code>   filter(!is.na(sex)) %>%  </code>
<code>   group_by(town, sex) %>%  </code>
<code>   summarise(totexp = mean(totexp)) </code>
<code>  </code>
<code> _____ + </code>
<code>   geom______(data = subset(dat, sex=="woman"), </code>
<code>                aes(x = _____, </code>
<code>                    y = _____, </code>
<code>                   _____)) + </code>
<code>   geom______(data = subset(dat, sex=="man"), </code>
<code>                aes(x = _____, </code>
<code>                    y = _____, </code>
<code>                   _____)) </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<p></exercise></p>
<p><exercise id="7" title="Scales and guides in `ggplot2`">
<iframe src='../slides/chapter7_04_ggplot2scales.html' width='800' height='500'></iframe>
</exercise></p>
<p><exercise id="8" title="Practice changing scales and guides."></p>
<p></exercise></p>
<p><exercise id="9" title="Multiple plots in one figure">
<iframe src='../slides/chapter7_05_ggplot2facet.html' width='800' height='500'></iframe>
</exercise></p>
<exercise id="10" title="Practice combining multiple plots.">
<div class="target">
<img src="ch7/plot7A-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_10A"></p>
</codeblock>
<pre class="r">
<code> ggplot(BudgetFood, aes(x = _____)) +  </code>
<code>   geom_histogram(data = _____, </code>
<code>                  fill = "grey", binwidth = 1, </code>
<code>                  aes(y = after_stat(density))) + </code>
<code>   geom_histogram(aes(y = after_stat(density)), </code>
<code>                  binwidth = 1) + </code>
<code>   geom_density(color = "red") + </code>
<code>   facet______ </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot7B-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_10B"></p>
</codeblock>
<pre class="r">
<code> ggplot(subset(BudgetFood, !is.na(sex)), aes(age)) + </code>
<code>   geom_histogram(aes(y = _____)) + </code>
<code>   geom_text(x = 35, y = 0.035,  </code>
<code>             data = function(.data) .data %>%  </code>
<code>               group_by(sex, town) %>%  </code>
<code>               count(), </code>
<code>             aes(label = n)) + </code>
<code>   facet______ </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<div class="target">
<img src="ch7/plot7C-1.png" width="576" style="display: block; margin: auto;" />
</div>
<p><codeblock id="07_10C"></p>
</codeblock>
<pre class="r">
<code> library(patchwork) </code>
<code> g1 <- ggplot(BudgetFood,  </code>
<code>              aes(factor(size), wfood, color = sex)) + </code>
<code>   geom_boxplot()  </code>
<code>  </code>
<code> g2 <- ggplot(BudgetFood,  </code>
<code>              aes(factor(size), totexp, color = sex)) + </code>
<code>   geom_boxplot() +  </code>
<code>   scale_y_log10() </code>
<code>  </code>
<code> g1 / g2 + plot_layout(guides = "collect") </code>
</pre>
<details open>
<summary>
Hint
</summary>
<ol start="20" style="list-style-type: upper-roman">
<li></li>
</ol>
</details>
<p></exercise></p>
<p><exercise id="11" title="Customise the look with themes in `ggplot2`">
<iframe src='../slides/chapter7_06_ggplot2theme.html' width='800' height='500'></iframe>
</exercise></p>
<p><exercise id="12" title="Make publication ready plots."></p>
<p></exercise></p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
