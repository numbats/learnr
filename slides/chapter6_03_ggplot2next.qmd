---
title: Plotting two or more variables with `ggplot2`
format: 
  revealjs:
    logo: monash-stacked-blue-rgb-transparent.png
    slide-number: true
    show-slide-number: all
    controls: true
    width: 1280
    height: 720
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(#fig.path = "images/chapter7-03/",
                      fig.align = "center",
                      fig.width = 6, 
                      fig.height = 4,
                      cache.path = "cache/",
                      cache = FALSE,
                      echo = TRUE,
                      warning = FALSE, 
                      message = FALSE)
library(ozmaps)
library(tidyverse)
oz_sf <- ozmap_data("states")
fig_path <- knitr::opts_chunk$get("fig.path")
```



```{r catalogue-setup, include = FALSE}
set.seed(1)
n1 <- 200
df1 <- tibble(x = runif(n1, 0, 10),
              y =  3 * x + rnorm(n1, 0, 10),
              z = rnorm(n1, 0, 2),
              g1 = sample(letters[1:4], size = n1, replace = TRUE),
              g2 = sample(letters[1:4], size = n1, replace = TRUE)) %>% 
  mutate(g1 = fct_reorder(g1, y, sum))
df2 <- diamonds %>% 
  sample_n(80)
df3 <- ToothGrowth %>% 
  mutate(dosef = factor(dose)) %>% 
  group_by(dosef, supp) %>% 
  summarise(mlen = factor(mean(len)))
sumdf1 <- df1 %>% 
  group_by(g1) %>% 
  summarise(y = sum(y))
sumdf2 <- df1 %>% 
  group_by(g1, g2) %>% 
  summarise(y = sum(y))
# generate 5 from colorspace and discard the tails which are too white
reds <- c("#7F000D", "#A9565A", "#CA9496", "#E2CBCB")
yellows <- c("#6A3F00", "#97742F", "#BAA588", "#D4CCC3")
green <- "#006400"
purples <- c("#312271", "#4F4293", "#6D60BB", "#8B80D1", "#A79FE1", "#C2BCF0", 
"#DAD6FA", "#EDEBFF", "#F9F9F9")

theme_base <- list(theme_void(base_size = 18) + 
  theme(plot.margin = margin(10, 10, 10, 10),
        plot.title.position = "plot",
        plot.title = element_text(margin = margin(t = -4, b = 10),
                                  size = 14, face = "bold")),
  guides(fill = "none"))

theme_rank <- c(theme_base,
                list(theme(plot.background = element_rect(fill = "#DCBFC9", 
                                       color = NA)),
                     scale_fill_manual(values = reds)))

theme_corr <- c(theme_base,
                list(theme(plot.background = element_rect(fill = "#EDDBB6", 
                                       color = NA))))

theme_dist <- c(theme_base,
                list(theme(plot.background = element_rect(fill = "#D7FBCD", 
                                       color = NA))))

theme_other <- c(theme_base,
                list(theme(plot.background = element_rect(fill = "#FFE5FF", 
                                       color = NA)),
                     scale_fill_manual(values = purples)))




theme_yaxis <- theme(axis.line.y = element_line(color = "black", size = 1),
                     axis.ticks.y = element_line(color = "black", 
                                                 linetype = "solid", 
                                                 size = 1, 
                                                 lineend = NULL),
                     axis.ticks.length.y = unit(0.3, "lines"))


theme_xaxis <- theme(axis.line.x = element_line(color = "black", size = 1),
                     axis.ticks.x = element_line(color = "black", 
                                                 linetype = "solid", 
                                                 size = 1, 
                                                 lineend = NULL),
                     axis.ticks.length.x = unit(0.3, "lines"))

theme_border <- theme(plot.background = element_rect(color = "black",
                                                     size = 3))
```


---

## Examining two or more variables

```{r catalogue-two, fig.width = 3, fig.height = 3, echo = FALSE, fig.show='hide'}
ggplot(df2, aes(carat, price)) +
  geom_point(color = yellows[1]) +
  theme_corr +
  theme_yaxis +
  theme_xaxis +
  theme_border + 
  ggtitle("SCATTER PLOT")

ggplot(economics, aes(date, uempmed)) +
  geom_line(color = yellows[1]) +
  theme_corr +
  theme_yaxis +
  theme_xaxis +
  theme_border + 
  ggtitle("LINE PLOT")

ggplot(df2, aes(carat, price, size = depth)) +
  geom_point(color = yellows[1], alpha = 0.3) +
  theme_corr +
  theme_yaxis +
  theme_xaxis +
  theme_border + 
  ggtitle("BUBBLE CHART") + guides(size = "none")

ggplot(sumdf2, aes(g1, y, fill = g2)) +
  geom_col() +
  theme_rank +
  theme_yaxis +
   theme_border + 
  ggtitle("STACKED\nBARPLOT")

ggplot(sumdf2, aes(g1, y, fill = g2)) +
  geom_col(position = "dodge") +
  theme_rank +
  theme_yaxis +
   theme_border + 
  ggtitle("GROUPED\nBARPLOT")

ggplot(sumdf2, aes(g1, y, fill = g2)) +
  geom_col(position = "fill") +
  theme_rank +
  theme_yaxis +
   theme_border + 
  ggtitle("STACKED\nPERCENTAGE\nBARPLOT")


ggplot(df3, aes(dosef, supp, fill = mlen)) +
  geom_tile(color = "black", size = 1.2) +
  theme_other +
   theme_border + 
  ggtitle("HEATMAP")



oz_sf %>%
  mutate(value = factor(rnorm(n()))) %>%
  ggplot(aes(fill = value)) +
  geom_sf() +
  theme_other +
   theme_border + 
  ggtitle("CHOROPLETH\nMAP")
```

<style>
.catalogue { 
  margin: 0!important; 
  width: 18%!important;
  margin-right: 2%!important;
}
</style>



`r x<-1:6;paste(glue::glue('<img class="catalogue" src="{fig_path}chapter7-02/catalogue-two-{x}.png"/>'), collapse = "")`



---

## Illustrative data üíé diamonds

* Let's have a look at the `diamonds` data which contains information about different attributes of diamonds

```{r}
data(diamonds, package = "ggplot2")
diamonds
```

---

## A scatterplot with `geom_point()`

```{r geom-point}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_point()
```

* Scatter plot of price vs carat of diamonds
* Each point correponds to a dimaond

---

## A hexagonal 2D heatmap with `geom_hex()`

```{r geom-hex}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_hex()
```

* A hexagon shows the count of observations within the region.

---

## A rectangular 2D heatmap with `geom_bin_2d()`

```{r geom-bin2d}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_bin_2d()
```

* Similar to `geom_hex()` but the shape is a rectangle.

---

## Count of overlapping points with `geom_count()`

```{r geom-count}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_count()
```

---

## Contour of a 2D density with `geom_density_2d()`

```{r geom-density-2d}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_density_2d()
```

---

## Contour of a 2D density with `geom_density_2d_filled()`

```{r geom-density-2d-filled}
ggplot(data = diamonds,
       mapping = aes(x = carat, y = price)) +
  geom_density_2d_filled()
```

---

## Motivating data ‚õ∞Ô∏è volcano 

* The data contains topographic information on Auckland's Maunga Whau Volcano
* The original data is a matrix and we must wrangle in the form ready for `ggplot` first.

```{r}
volcanod <- data.frame(row = as.vector(row(volcano)),
                       col = as.vector(col(volcano)),
                       value = as.vector(volcano))

volcanod
```



---

## A 2D contour plot with `geom_contour()`

```{r geom-contour}
ggplot(data = volcanod, 
       mapping = aes(x = col, y = row, z = value)) + 
  geom_contour()
```


---

## A 2D contour plot with `geom_contour_filled()`

```{r geom-contour-filled}
ggplot(data = volcanod, 
       mapping = aes(x = col, y = row, z = value)) + 
  geom_contour_filled()
```



---

## Tile plots with `geom_tile()`

```{r geom-tile}
ggplot(volcanod, aes(col, row, fill = value)) +
 geom_tile()
```

---

## Raster plots with `geom_raster()`

```{r geom-raster}
ggplot(volcanod, aes(col, row, fill = value)) +
 geom_raster()
```

* A high performance special case of `geom_tile()` for when the tiles are the same size

---

## Rectangular plots with `geom_rect()`

```{r geom-rect}
ggplot(volcanod, aes(xmin = col - 0.5, xmax = col + 0.5,
                     ymin = row - 0.5, ymax = row + 0.5, fill = value)) +
 geom_rect()
```

* A reparameterised version of `geom_tile()`

---

## Motivating data üìà economics


```{r}
data(economics, package = "ggplot2")
economics
```


---

## Line plot with `geom_line()`

```{r geom-line}
ggplot(economics, aes(date, unemploy)) + 
  geom_line()
```

---

## `geom_path()`

```{r geom-path}
ggplot(economics, aes(unemploy/pop, psavert)) +
  geom_path()
```

---

## `geom_step()`

```{r geom-step}
ggplot(economics, aes(unemploy/pop, psavert)) +
  geom_step()
```

---

## Drawing maps

* Drawing maps require the map data 

```{r}
world <- map_data("world")
world
```

---

## Drawing world map with `geom_polygon()`

```{r geom-polygon, eval = FALSE}
world <- map_data("world")
ggplot(world, aes(long, lat, group = group)) +
  geom_polygon()
```

